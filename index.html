<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoE2 Temple Architect Pro</title>
    <style>
        :root { --bg: #050507; --gold: #c1a058; --red: #ff4444; --spy: #8a2be2; --legion: #ff4500; }
        body { font-family: 'Cinzel', serif; background: var(--bg); color: #ddd; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        .header { text-align: center; border-bottom: 2px solid #2a2015; margin-bottom: 20px; padding-bottom: 10px; width: 100%; max-width: 600px; }
        .grid { display: grid; grid-template-columns: repeat(9, 50px); gap: 2px; background: #1a1510; padding: 10px; border: 4px solid #2a2015; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .cell { width: 50px; height: 50px; background: #0c0c0e; border: 1px solid #222; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; transition: 0.2s; }
        .cell:hover { background: #1a1a1f; border-color: var(--gold); }
        .entrance { border: 2px solid var(--gold) !important; background: radial-gradient(circle, #2a2310 0%, #0c0c0e 100%); }
        .disconnected { opacity: 0.3; filter: grayscale(1); }
        .loop-error { border-color: var(--red) !important; box-shadow: inset 0 0 8px var(--red); }
        .lvl { font-size: 10px; color: var(--gold); font-weight: bold; margin-top: -2px; }
        .icon { font-size: 18px; }
        .controls { margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        button { background: #1a1510; color: var(--gold); border: 1px solid var(--gold); padding: 10px 15px; cursor: pointer; font-weight: bold; font-family: inherit; }
        button:hover { background: var(--gold); color: black; }
        .stats-panel { background: #121215; border: 2px solid #2a2015; padding: 20px; width: 100%; max-width: 500px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-card { border-left: 3px solid var(--gold); padding-left: 10px; }
        .stat-label { font-size: 12px; color: #888; text-transform: uppercase; }
        .stat-val { font-size: 20px; font-weight: bold; color: #fff; }
        .legend { margin-top: 15px; font-size: 12px; display: flex; gap: 15px; color: #aaa; }
    </style>
</head>
<body>
    <div class="header">
        <h1 style="color: var(--gold); margin: 0;">VAAL ARCHITECT PRO</h1>
        <div style="font-size: 12px; letter-spacing: 2px;">9x9 GRID • FATE OF THE VAAL 0.4</div>
    </div>

    <div id="grid" class="grid"></div>

    <div class="controls">
        <button onclick="changeBrush(3)">SPYMASTER</button>
        <button onclick="changeBrush(2)">BARRACKS</button>
        <button onclick="changeBrush(1)">ARMOURY</button>
        <button onclick="reset()" style="border-color: var(--red); color: var(--red);">RESET</button>
        <button onclick="autoSolve()" style="background: var(--gold); color: black;">AUTO-SNAKE SOLVER</button>
    </div>

    <div class="stats-panel">
        <div class="stat-card">
            <div class="stat-label">Rare Effectiveness</div>
            <div id="rare-pwr" class="stat-val">0%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Spymaster Multi</div>
            <div id="spy-multi" class="stat-val">1.00x</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Medallion Drop Chance</div>
            <div id="med-chance" class="stat-val">0%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Rooms</div>
            <div id="active-count" class="stat-val">0</div>
        </div>
    </div>

    <div class="legend">
        <span><b style="color:cyan">●</b> Armoury</span>
        <span><b style="color:orange">●</b> Barracks/Legion</span>
        <span><b style="color:purple">●</b> Spymaster</span>
    </div>

<script>
    const SIZE = 9;
    const START = [4, 0];
    let brush = 3; 
    let map = Array(SIZE).fill().map(() => Array(SIZE).fill(0));

    function init() {
        const gridEl = document.getElementById('grid');
        for(let y=0; y<SIZE; y++) {
            for(let x=0; x<SIZE; x++) {
                const cell = document.createElement('div');
                cell.id = `c-${x}-${y}`;
                cell.className = 'cell';
                if(x === START[0] && y === START[1]) cell.classList.add('entrance');
                cell.onclick = () => handleCellClick(x, y);
                gridEl.appendChild(cell);
            }
        }
        update();
    }

    function handleCellClick(x, y) {
        if(x === START[0] && y === START[1]) return;
        map[y][x] = map[y][x] === brush ? 0 : brush;
        update();
    }

    function changeBrush(t) { brush = t; }

    function autoSolve() {
        reset();
        const path = [];
        // SNAKE LOGIC: Optimized for 9x9 path length
        for(let x=5; x<9; x++) path.push([x,0]);
        for(let y=1; y<9; y++) {
            if(y%2===1) { for(let x=8; x>=0; x--) path.push([x,y]); }
            else { for(let x=0; x<=8; x++) path.push([x,y]); }
        }
        for(let x=0; x<4; x++) path.push([x,0]);

        path.forEach((p, i) => {
            // Strategic placement: Commanders at the end to force T3
            let type = (i > path.length - 8) ? 2 : (i % 4 === 0 ?
